<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Adding an Operations Problem Model · PowerSimulations.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="PowerSimulations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PowerSimulations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><a class="tocitem" href="../../quick_start_guide/">Quick Start Guide</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../decision_problem/">Single-step Problem</a></li><li><a class="tocitem" href="../pcm_simulation/">Multi-stage Production Cost Simulation</a></li></ul></li><li><span class="tocitem">Modeler Guide</span><ul><li><a class="tocitem" href="../../modeler_guide/definitions/">Definitions</a></li><li><a class="tocitem" href="../../modeler_guide/psi_structure/">PowerSimulations.jl Modeling Structure</a></li><li><a class="tocitem" href="../../modeler_guide/problem_templates/">Operations <code>ProblemTemplate</code>s</a></li><li><a class="tocitem" href="../../modeler_guide/running_a_simulation/">Simulation</a></li><li><a class="tocitem" href="../../modeler_guide/read_results/">Read results</a></li><li><a class="tocitem" href="../../modeler_guide/simulation_recorder/">Simulation Recorder</a></li><li><a class="tocitem" href="../../modeler_guide/logging/">Logging</a></li><li><a class="tocitem" href="../../modeler_guide/debugging_infeasible_models/">Debugging infeasible models</a></li><li><a class="tocitem" href="../../modeler_guide/parallel_simulations/">Parallel Simulations</a></li><li><a class="tocitem" href="../../modeler_guide/modeling_faq/">Modeling FAQ</a></li></ul></li><li><span class="tocitem">Model Developer Guide</span><ul><li><a class="tocitem" href="../../model_developer_guide/structure_of_operation_problem/">Operation Problem Structure</a></li><li><a class="tocitem" href="../../model_developer_guide/troubleshooting/">Troubleshooting</a></li></ul></li><li><span class="tocitem">Code Base Developer Guide</span><ul><li><a class="tocitem" href="../../code_base_developer_guide/developer/">Developer Guide</a></li><li><a class="tocitem" href="../../code_base_developer_guide/troubleshooting/">Troubleshooting</a></li></ul></li><li><span class="tocitem">Formulation Library</span><ul><li><a class="tocitem" href="../../formulation_library/Introduction/">Introduction</a></li><li><a class="tocitem" href="../../formulation_library/General/">General</a></li><li><a class="tocitem" href="../../formulation_library/Network/">Network</a></li><li><a class="tocitem" href="../../formulation_library/ThermalGen/">Thermal Generation</a></li><li><a class="tocitem" href="../../formulation_library/RenewableGen/">Renewable Generation</a></li><li><a class="tocitem" href="../../formulation_library/Load/">Load</a></li><li><a class="tocitem" href="../../formulation_library/Branch/">Branch</a></li><li><a class="tocitem" href="../../formulation_library/Service/">Services</a></li><li><a class="tocitem" href="../../formulation_library/Feedforward/">Feedforwards</a></li><li><a class="tocitem" href="../../formulation_library/Piecewise/">Piecewise Linear Cost</a></li></ul></li><li><a class="tocitem" href="../../api/PowerSimulations/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Adding an Operations Problem Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Adding an Operations Problem Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-Sienna/PowerSimulations.jl/blob/main/docs/src/tutorials/adding_new_problem_model.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Adding-an-Operations-Problem-Model"><a class="docs-heading-anchor" href="#Adding-an-Operations-Problem-Model">Adding an Operations Problem Model</a><a id="Adding-an-Operations-Problem-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-an-Operations-Problem-Model" title="Permalink"></a></h1><p>This tutorial will show how to create a custom decision problem model. These cases are the ones where the user want to solve a fully specified problem. Some examples of custom decision models include:</p><ul><li>Solving a custom Security Constrained Unit Commitment Problem</li><li>Solving a market agent utility maximization Problem. See examples of this functionality in HybridSystemsSimulations.jl</li></ul><p>The tutorial follows the usual steps for operational model building. First, build the decision model in isolation and second, integrate it into a simulation. In most cases there will be more than one way of achieving the same objective when it comes to implementing the model. This guide shows a general set of steps and requirements but it is by no means an exhaustive and detailed guide on developing custom decision models.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>All the code in this tutorial is considered &quot;pseudo-code&quot;. Copy-paste will likely not work out of the box. You need to develop the internals of the functions correctly for the examples below to work.</p></div></div><h2 id="General-Rules"><a class="docs-heading-anchor" href="#General-Rules">General Rules</a><a id="General-Rules-1"></a><a class="docs-heading-anchor-permalink" href="#General-Rules" title="Permalink"></a></h2><ol><li>As a general rule you need to understand Julia&#39;s terminology such as multiple dispatch, parametric structs and method overloading, among others. Developing custom models for an operational simulation is a highly technical task and requires skilled development. This tutorial also requires good understanding of PowerSystems.jl data structures and features which are covered in the tutorials section of PowerSystems.jl documentation.</li></ol><p>Finally, developing a custom model decision model that will employ an optimization model under the hood requires understanding JuMP.jl.</p><ol><li>Need to employ <a href="https://jump.dev/JuMP.jl/stable/manual/variables/#anonymous_variables">anonymous constraints and variables in JuMP</a></li></ol><p>and register the constraints, variables and other optimization objects into PowerSimulations.jl&#39;s optimization container. Otherwise the features to use your problem in the simulation like the coordination with other problems and post processing won&#39;t work. More on this in the section <a href="#How-to-develop-your-build_model!-function">How to develop your <code>build_model!</code> function</a> below.</p><ol><li>Implement the required methods for your custom decision models. In some cases it will be possible to re-use some of the other methods that exist in PowerSimulations to make life easier for variable addition and constraint creation but this is not required.</li></ol><h2 id="Decision-Problem"><a class="docs-heading-anchor" href="#Decision-Problem">Decision Problem</a><a id="Decision-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Decision-Problem" title="Permalink"></a></h2><h3 id="Step-1:-Define-a-Custom-Decision-Problem"><a class="docs-heading-anchor" href="#Step-1:-Define-a-Custom-Decision-Problem">Step 1: Define a Custom Decision Problem</a><a id="Step-1:-Define-a-Custom-Decision-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-Define-a-Custom-Decision-Problem" title="Permalink"></a></h3><p>Define a decision problem struct as a subtype of <code>PowerSimulations.DecisionProblem</code>. This requirement will enable a lot of the underlying functionality that relies on multiple dispatch. DecisionProblems are used to parameterize the behavior of <code>DecisionModel</code> objects which are just containers for the parameters, references and the optimization problem.</p><p>It is possible to define a Custom Decision Problem that gives the user full control over the build, solve and execution process since it imposes less requirements on the developer. However, with less requirements there are also less checks and validations performed inside of PowerSimulations which might lead to unexpected errors</p><pre><code class="language-julia hljs">struct MyCustomDecisionProblem &lt;: PSI.DecisionProblem end</code></pre><p>Alternatively, it is possible to define a Custom Decision Problem subtyping from <code>DefaultDecisionProblem</code> which imposes more requirements and structure onto the developer but employs more checks and validations in the process. Be aware that this route will decrease the flexibility of what can be done inside the custom model.</p><pre><code class="language-julia hljs">struct MyCustomDecisionProblem &lt;: PSI.DefaultDecisionProblem end</code></pre><p>Once the problem type is defined, initialize the decision model container with your custom decision problem passing the solver and some of the settings you need for the solution of the problem. For custom problems some of the settings need manual implementation by the developer. Settings availability is also dependent on wether  you choose to subtype from <code>PSI.DecisionProblem</code> or <code>PSI.DefaultDecisionProblem</code></p><pre><code class="language-julia hljs">my_model = DecisionModel{MyCustomDecisionProblem}(
    sys;
    name = &quot;MyModel&quot;,
    optimizer = optimizer_with_attributes(HiGHS.Optimizer),
     optimizer_solve_log_print = true,
)</code></pre><h4 id="Mandatory-Method-Implementations"><a class="docs-heading-anchor" href="#Mandatory-Method-Implementations">Mandatory Method Implementations</a><a id="Mandatory-Method-Implementations-1"></a><a class="docs-heading-anchor-permalink" href="#Mandatory-Method-Implementations" title="Permalink"></a></h4><ol><li><code>build_model!</code>: This method build the <code>JuMP</code> optimization model.</li></ol><h4 id="Optional-Method-Overloads"><a class="docs-heading-anchor" href="#Optional-Method-Overloads">Optional Method Overloads</a><a id="Optional-Method-Overloads-1"></a><a class="docs-heading-anchor-permalink" href="#Optional-Method-Overloads" title="Permalink"></a></h4><p>These methods can be defined optionally for your problem. By default for problems subtyped from <code>DecisionProblem</code> these checks are not executed. If the problems are subtyped from <code>DefaultDecisionProblem</code> these checks are always conducted with PowerSimulations defaults and require compliance with those defaults to pass. In any case, these can be overloaded when necessary depending on the problem requirements.</p><ol><li><code>validate_template</code></li><li><code>validate_time_series!</code></li><li><code>reset!</code></li><li><code>solve_impl!</code></li></ol><h3 id="How-to-develop-your-build_model!-function"><a class="docs-heading-anchor" href="#How-to-develop-your-build_model!-function">How to develop your <code>build_model!</code> function</a><a id="How-to-develop-your-build_model!-function-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-develop-your-build_model!-function" title="Permalink"></a></h3><h4 id="Registering-a-variable-in-the-model"><a class="docs-heading-anchor" href="#Registering-a-variable-in-the-model">Registering a variable in the model</a><a id="Registering-a-variable-in-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Registering-a-variable-in-the-model" title="Permalink"></a></h4><p>To register a variable in the model, the developer must first allocate the container into the optimization container and then populate it. For example, it require start the build function as follows:</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>We recommend calling <code>import PowerSimulations</code> and defining the constant <code>CONST PSI = PowerSimulations</code> to make it easier to read the code and determine which package is responsible for defining the functions.</p></div></div><pre><code class="language-julia hljs">    function PSI.build_model!(model::PSI.DecisionModel{MyCustomDecisionProblem})
        container = PSI.get_optimization_container(model)
        time_steps = 1:24
        PSI.set_time_steps!(container, time_steps)
        system = PSI.get_system(model)

        thermal_gens = PSY.get_components(PSY.ThermalStandard, system)
        thermal_gens_names = PSY.get_name.(thermal_gens)

        # Create the container for the variable
        variable = PSI.add_variable_container!(
            container,
            PSI.ActivePowerVariable(), # &lt;- This variable is defined in PowerSimulations but the user can define their own
            PSY.ThermalGeneration, # &lt;- Device type for the variable. Can be from PSY or custom defined
            thermal_gens_names, # &lt;- First container dimension
            time_steps, # &lt;- Second container dimension
        )

        # Iterate over the devices and time to store the JuMP variables into the container.
        for t in time_steps, d in thermal_gens_names
            name = PSY.get_name(d)
            variable[name, t] = JuMP.@variable(get_jump_model(container))
            # It is possible to use PSY getter functions to retrieve data from the generators
            JuMP.set_upper_bound(variable[name, t], UB_DATA) # &lt;- Optional
            JuMP.set_lower_bound(variable[name, t], LB_DATA) # &lt;- Optional
        end

        # Add More Variables.....

        return
    end</code></pre><h4 id="Registering-a-constraint-in-the-model"><a class="docs-heading-anchor" href="#Registering-a-constraint-in-the-model">Registering a constraint in the model</a><a id="Registering-a-constraint-in-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Registering-a-constraint-in-the-model" title="Permalink"></a></h4><p>A similar pattern is used to add constraints to the model, in this example the field <code>meta</code> is used to avoid creating unnecessary duplicate constraint types. For instance to reflect upper<em>bound and lower</em>bound or upwards and downwards constraints. Meta can take any string value except for the <code>_</code> character.</p><pre><code class="language-julia hljs">    function PSI.build_model!(model::PSI.DecisionModel{MyCustomDecisionProblem})
        container = PSI.get_optimization_container(model)
        time_steps = 1:24
        PSI.set_time_steps!(container, time_steps)
        system = PSI.get_system(model)

        # VARIABLE ADDITION CODE

        # Constraint additions
        con_ub = PSI.add_constraints_container!(
            container,
            PSI.RangeLimitConstraint(), # &lt;- Constraint Type defined by PSI or your own
            PSY.ThermalGeneration, # &lt;- Device type for variable. Can be PSY or custom
            thermal_gens_names, # &lt;- First container dimension
            time_steps; # &lt;- Second container dimension
            meta = &quot;ub&quot; # &lt;- meta allows to reuse a constraint definition for similar constraints. It only requires to be a string
            )

        con_lb = PSI.add_constraints_container!(
            container,
            PSI.RangeLimitConstraint(),
            PSY.ThermalGeneration,
            thermal_gens_names, # &lt;- First container dimension
            time_steps; # &lt;- Second container dimension
            meta = &quot;lb&quot; # &lt;- meta allows to reuse a constraint definition for similar constraints. It only requires to be a string
            )

        # Retrieve a relevant variable from the container if not defined in
        variable = PSI.get_variable(container, PSI.ActivePowerVariable(), PSY.ThermalGeneration)
        for device in devices, t in time_steps
            ci_name = PSY.get_name(device)
            limits = get_min_max_limits(device) # depends on constraint type and formulation type
            con_ub[ci_name, t] =
                JuMP.@constraint(get_jump_model(container), variable[ci_name, t] &gt;= limits.min)
            con_lb[ci_name, t] =
                JuMP.@constraint(get_jump_model(container), variable[ci_name, t] &gt;= limits.min)
        end

        return
    end</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 25 September 2024 18:06">Wednesday 25 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
